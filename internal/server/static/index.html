<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>K8V - Kubernetes Visualizer</title>
  <!-- Fonts to match prototype -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Feather Icons for consistent icon design -->
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="./style.css">
</head>
<body>
  <div class="container">
    <div class="top-nav">
      <div class="logo">K8</div>
      <div class="nav-tabs">
        <button class="nav-tab active" data-main-tab="dashboard">Dashboard</button>
        <button class="nav-tab" data-main-tab="topology">Topology</button>
      </div>
      <div class="nav-right">
        <span id="connection-status">Connecting...</span>
        <span>â€¢</span>
        <span id="resource-count">0 resources</span>
      </div>
    </div>

    <div class="main-wrapper">
      <!-- Dashboard View -->
      <div class="sidebar" id="dashboard-view">
        <div class="header">
          <h1>Cluster Dashboard</h1>
          <div class="header-meta">
            <span>Live updates over WebSocket</span>
          </div>
        </div>

        <!-- Stats cards -->
        <div class="stats">
          <div class="stat-card highlight"><div class="stat-label">Total Resources</div><div class="stat-value" id="stat-total">0</div></div>
          <div class="stat-card"><div class="stat-label">Pods</div><div class="stat-value" id="stat-pod">0</div></div>
          <div class="stat-card"><div class="stat-label">Deployments</div><div class="stat-value" id="stat-deployment">0</div></div>
          <div class="stat-card"><div class="stat-label">ReplicaSets</div><div class="stat-value" id="stat-replicaset">0</div></div>
          <div class="stat-card"><div class="stat-label">Services</div><div class="stat-value" id="stat-service">0</div></div>
          <div class="stat-card"><div class="stat-label">Ingress</div><div class="stat-value" id="stat-ingress">0</div></div>
          <div class="stat-card"><div class="stat-label">ConfigMaps</div><div class="stat-value" id="stat-configmap">0</div></div>
          <div class="stat-card"><div class="stat-label">Secrets</div><div class="stat-value" id="stat-secret">0</div></div>
          <div class="stat-card"><div class="stat-label">Nodes</div><div class="stat-value" id="stat-node">0</div></div>
        </div>

        <!-- Context Filter -->
        <div class="resource-filter">
          <div class="filter-label">Cluster Context</div>
          <k8v-dropdown id="context-dropdown" placeholder="Loading..."></k8v-dropdown>
        </div>

        <!-- Namespace Filter -->
        <div class="resource-filter">
          <div class="filter-label">Namespace</div>
          <k8v-dropdown id="namespace-dropdown" placeholder="All Namespaces"></k8v-dropdown>
        </div>

        <!-- Search Filter (Vim-style activation) -->
        <div class="search-filter" id="search-filter-container">
          <div class="filter-label">Search Resources</div>
          <div class="search-trigger" id="search-trigger">
            <i data-feather="search" style="width: 16px; height: 16px; margin-right: 8px;"></i>
            <span class="search-placeholder">Press <kbd>/</kbd> to search by name</span>
          </div>
          <div class="search-active" id="search-active" style="display: none;">
            <input
              type="text"
              class="search-input"
              id="search-input"
              placeholder="Type to filter by name... (Esc to clear)"
              autocomplete="off"
            />
            <button class="search-clear" id="search-clear" title="Clear search (Esc)">
              <i data-feather="x" style="width: 16px; height: 16px;"></i>
            </button>
          </div>
        </div>

        <!-- Resource Type Filters -->
        <div class="resource-filter">
          <div class="filter-label">Resource Type</div>
          <div class="filter-buttons" id="filters"></div>
        </div>

        <!-- Resource cards list -->
        <div class="resource-list" id="resource-list"></div>

        <!-- Loading state -->
        <div class="loading-state" id="loading-state" style="display: none;">
          <div class="loading-spinner"></div>
          <div class="loading-text">Syncing informer caches...</div>
          <div class="loading-subtext" id="loading-subtext">This may take a while for large clusters</div>
        </div>
      </div>

      <!-- Topology View -->
      <div class="sidebar" id="topology-view" style="display: none;">
        <div class="header">
          <h1>Cluster Topology</h1>
          <div class="header-meta">
            <span>Resource relationship visualization</span>
          </div>
        </div>
        <div style="grid-column: 1 / -1; padding: 40px; text-align: center; color: #888;">
          <div style="margin-bottom: 16px;"><i data-feather="git-branch" style="width: 48px; height: 48px; stroke-width: 1.5;"></i></div>
          <h2 style="color: #C4F561; margin-bottom: 8px;">Topology View Coming Soon</h2>
          <p>Interactive resource relationship diagrams will be available in a future update.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Events toggle button -->
  <button class="events-toggle" id="events-toggle" title="View Recent Events">
    <i data-feather="activity"></i>
    <span class="events-badge" id="events-badge" style="display: none;">0</span>
  </button>

  <!-- Events drawer -->
  <div id="events-drawer">
    <div class="events-drawer-header">
      <h2>Recent Events</h2>
      <button class="nav-tab" id="events-close" title="Close" style="background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:8px;">
        <i data-feather="x"></i>
      </button>
    </div>
    <div class="events-drawer-content" id="events"></div>
  </div>

  <!-- Detail panel -->
  <div id="detail-panel">
    <div class="detail-header">
      <h2 id="detail-title">Resource Details</h2>
      <div style="display: flex; gap: 8px;">
        <button class="nav-tab" id="detail-fullscreen" title="Toggle Fullscreen" style="background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:8px;">
          <i data-feather="maximize" id="fullscreen-icon"></i>
        </button>
        <button class="nav-tab" id="detail-close" title="Close" style="background:transparent;border:1px solid rgba(255,255,255,0.1);border-radius:8px;">
          <i data-feather="x"></i>
        </button>
      </div>
    </div>
    <div class="panel-tabs">
      <div class="tab active" data-tab="overview">
        <i data-feather="info" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;"></i>
        Overview
      </div>
      <div class="tab" data-tab="yaml">
        <i data-feather="code" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;"></i>
        YAML
      </div>
      <div class="tab" id="logs-tab-button" data-tab="logs" style="display: none;">
        <i data-feather="terminal" style="width: 16px; height: 16px; margin-right: 6px; vertical-align: middle;"></i>
        Logs
      </div>
    </div>
    <div class="panel-content">
      <div id="overview-tab" class="tab-content active">
        <div class="section">
          <h3>Status</h3>
          <div class="info-grid" id="status-info"></div>
        </div>
        <div class="section" id="relationships-section"><h3>Relationships</h3></div>
      </div>
      <div id="yaml-tab" class="tab-content"><pre><code id="yaml-content"></code></pre></div>
      <div id="logs-tab" class="tab-content logs-tab">
        <!-- Container selection (for multi-container pods) -->
        <div id="container-selector" class="container-selector" style="display: none;">
          <div class="filter-label">Container</div>
          <k8v-dropdown id="container-dropdown" placeholder="-- Choose Container --"></k8v-dropdown>
        </div>

        <!-- Log display area -->
        <div id="logs-content" style="
          background: rgba(0,0,0,0.3);
          border: 1px solid rgba(255,255,255,0.1);
          border-radius: 6px;
          padding: 12px;
          flex: 1;
          min-height: 0;
          overflow-y: auto;
          overflow-x: hidden;
          font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Courier New', monospace;
          font-size: 13px;
          line-height: 1.5;
          color: rgba(255,255,255,0.9);
          white-space: pre-wrap;
          word-wrap: break-word;
        "></div>

        <!-- Loading state -->
        <div id="logs-loading" style="display: none; text-align: center; padding: 40px; color: rgba(255,255,255,0.5);">
          Loading logs...
        </div>

        <!-- Error state -->
        <div id="logs-error" style="display: none; padding: 20px; color: #ff6b6b; background: rgba(255,107,107,0.1); border-radius: 6px; margin-top: 16px;">
          <strong>Error:</strong> <span id="logs-error-message"></span>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
